<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Previsao de Demanda</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header Compacto -->
        <div class="header-compact">
            <div class="logo-section">
                <h1>Previsao de Demanda</h1>
                <p>Multi-Loja + CD</p>
            </div>
        </div>

        <!-- Grid Layout Principal -->
        <div class="main-grid">
            <!-- Coluna Esquerda: Upload e Configura√ß√µes -->
            <div class="sidebar-left">
                <div class="upload-section-compact card-compact">
                    <h3>Upload & Config</h3>
                    <form id="uploadForm" enctype="multipart/form-data">
                        <div class="file-input-compact">
                            <input type="file" id="file" name="file" accept=".xlsx,.xls" required>
                        </div>

                        <div class="config-compact">
                            <label for="meses_previsao">Meses:</label>
                            <input type="number" id="meses_previsao" name="meses_previsao"
                                   value="6" min="1" max="24">
                        </div>

                        <button type="submit" class="btn-primary-compact">
                            Processar
                        </button>
                    </form>

                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <a href="/eventos_simples" class="btn-secondary-compact" style="display: block; text-align: center; text-decoration: none; padding: 8px; margin-bottom: 8px;">
                            üìÖ Gerenciar Eventos ‚Üí
                        </a>
                        <a href="/simulador" class="btn-secondary-compact" style="display: block; text-align: center; text-decoration: none; padding: 8px; margin-bottom: 8px;">
                            üéØ Simulador de Cen√°rios ‚Üí
                        </a>
                        <a href="/reabastecimento" class="btn-secondary-compact" style="display: block; text-align: center; text-decoration: none; padding: 8px;">
                            üì¶ Ir para Reabastecimento ‚Üí
                        </a>
                    </div>
                </div>
            </div>

            <!-- Coluna Central e Direita: Conte√∫do Principal -->
            <div class="main-content">

                <div id="progress" class="progress-section-compact card-compact" style="display:none;">
                    <div class="progress-bar-compact">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p id="progressText" class="progress-text-compact">Processando...</p>
                </div>

                <div id="results" class="results-section-compact" style="display:none;">
                    <!-- Cards de Resumo Compactos - Layout Executivo -->
                    <div id="resumo" class="resumo-cards-compact"></div>

                    <!-- Explica√ß√£o MAPE e BIAS -->
                    <div class="card-compact" style="margin-top: 15px; padding: 15px; background-color: #f8f9fa;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 0.85em;">
                            <div>
                                <h4 style="margin: 0 0 8px 0; color: #0070f3; font-size: 0.95em;">üìä MAPE (Mean Absolute Percentage Error)</h4>
                                <p style="margin: 0; line-height: 1.5; color: #555;">
                                    <strong>Mede a acur√°cia</strong> das previs√µes em rela√ß√£o aos valores reais.<br>
                                    <span style="color: #059669;">‚Ä¢ &lt; 10%:</span> Excelente<br>
                                    <span style="color: #d97706;">‚Ä¢ 10-20%:</span> Bom<br>
                                    <span style="color: #dc2626;">‚Ä¢ &gt; 20%:</span> Requer aten√ß√£o
                                </p>
                            </div>
                            <div>
                                <h4 style="margin: 0 0 8px 0; color: #0070f3; font-size: 0.95em;">üìà BIAS (Vi√©s de Previs√£o)</h4>
                                <p style="margin: 0; line-height: 1.5; color: #555;">
                                    <strong>Identifica tend√™ncia</strong> sistem√°tica de erro.<br>
                                    <span style="color: #dc2626;">‚Ä¢ Positivo (+):</span> Superestima√ß√£o<br>
                                    <span style="color: #059669;">‚Ä¢ Pr√≥ximo de 0:</span> Balanceado<br>
                                    <span style="color: #0ea5e9;">‚Ä¢ Negativo (-):</span> Subestima√ß√£o
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Alertas Compactos -->
                    <div id="alertas" class="alertas-compact"></div>

                    <!-- Compara√ß√£o YoY: Tabela + Gr√°fico -->
                    <div class="grafico-section-compact card-compact">
                        <div class="grafico-header">
                            <h3 style="background: linear-gradient(135deg, #32CD32 0%, #228B22 100%); color: white; padding: 12px; border-radius: 8px; margin: -15px -15px 15px -15px;">Compara√ß√£o: Previs√£o vs Per√≠odo Anterior</h3>
                        </div>

                        <!-- Tabela Comparativa ACIMA do Gr√°fico -->
                        <div style="margin-bottom: 25px;">
                            <table id="yoyComparisonTable" style="width: 100%; font-size: 0.75em; border-collapse: collapse; text-align: center;">
                                <thead id="yoyComparisonHeader">
                                    <!-- Preenchido dinamicamente pelo JavaScript -->
                                </thead>
                                <tbody id="yoyComparisonBody">
                                    <!-- Preenchido dinamicamente pelo JavaScript -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Gr√°fico ABAIXO da Tabela -->
                        <div class="chart-container-compact" style="height: 300px;">
                            <canvas id="yoyChart"></canvas>
                        </div>
                    </div>

                    <!-- Tabela Fornecedor/Item -->
                    <div class="card-compact">
                        <h3>üìä Previs√£o por Fornecedor/Item</h3>

                        <!-- Legenda dos Alertas -->
                        <div style="margin-bottom: 15px; padding: 12px; background-color: #f8f9fa; border-radius: 6px; border: 1px solid #e9ecef;">
                            <div style="font-weight: bold; color: #495057; margin-bottom: 8px; font-size: 0.9em;">
                                üîç Legenda dos Indicadores
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 0.85em;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.3em;">üî¥</span>
                                    <div>
                                        <strong style="color: #dc2626;">Cr√≠tico</strong>
                                        <div style="color: #666; font-size: 0.9em;">Requer a√ß√£o imediata</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.3em;">üü°</span>
                                    <div>
                                        <strong style="color: #f59e0b;">Alerta</strong>
                                        <div style="color: #666; font-size: 0.9em;">Varia√ß√£o &gt; 50%</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.3em;">üîµ</span>
                                    <div>
                                        <strong style="color: #3b82f6;">Aten√ß√£o</strong>
                                        <div style="color: #666; font-size: 0.9em;">Varia√ß√£o &gt; 20%</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 1.3em;">üü¢</span>
                                    <div>
                                        <strong style="color: #10b981;">Normal</strong>
                                        <div style="color: #666; font-size: 0.9em;">Varia√ß√£o ‚â§ 20%</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="overflow-x: auto;">
                            <table id="fornecedorItemTable" style="width: 100%; font-size: 0.85em; border-collapse: collapse;">
                                <tbody id="fornecedorItemBody"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Bot√£o Download Compacto -->
                    <div class="download-section-compact">
                        <a id="downloadBtn" class="btn-download-compact" download>
                            Download Excel
                        </a>
                    </div>
                </div>

                <div id="error" class="error-section-compact card-compact" style="display:none;">
                    <h3>Erro</h3>
                    <p id="errorMessage"></p>
                    <button onclick="location.reload()" class="btn-secondary-compact">Tentar Novamente</button>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
