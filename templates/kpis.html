<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPIs - Demanda e Reabastecimento</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        .kpi-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .page-header h1 {
            margin: 0 0 10px 0;
            font-size: 2em;
        }

        .page-header p {
            margin: 0;
            opacity: 0.9;
        }

        /* Filtros */
        .filters-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.9em;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
            background-color: #f8f9fa;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #667eea;
            background-color: white;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 24px;
            border: none;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        /* Tabs de Vis√£o Temporal */
        .view-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
        }

        .view-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 1em;
            font-weight: 600;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-tab:hover {
            color: #495057;
            background: #f8f9fa;
        }

        .view-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        /* Se√ß√µes de KPI */
        .kpi-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .kpi-section-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .kpi-section-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .kpi-section-title {
            flex: 1;
        }

        .kpi-section-title h2 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 1.5em;
        }

        .kpi-section-title p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9em;
        }

        /* Cards de M√©tricas Atuais */
        .current-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            transition: all 0.2s;
        }

        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .metric-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .metric-label {
            font-size: 0.85em;
            color: #6c757d;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-trend {
            font-size: 0.85em;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .trend-up {
            background: #d4edda;
            color: #155724;
        }

        .trend-down {
            background: #f8d7da;
            color: #721c24;
        }

        .trend-stable {
            background: #d1ecf1;
            color: #0c5460;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .metric-subtitle {
            font-size: 0.85em;
            color: #6c757d;
        }

        /* Gr√°ficos */
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .chart-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        /* Grid de Gr√°ficos */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .charts-grid-2col {
            grid-template-columns: 1fr 1fr;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px;
            color: #6c757d;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tabela de Detalhamento */
        .detail-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9em;
        }

        .detail-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        .detail-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-table tr:hover {
            background: #f8f9fa;
        }

        /* Badge de Status */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-excellent { background: #d4edda; color: #155724; }
        .status-good { background: #d1ecf1; color: #0c5460; }
        .status-warning { background: #fff3cd; color: #856404; }
        .status-critical { background: #f8d7da; color: #721c24; }

        /* Visibilidade de Tabs */
        .view-content {
            display: none;
        }

        .view-content.active {
            display: block;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .charts-grid-2col {
                grid-template-columns: 1fr;
            }

            .current-metrics {
                grid-template-columns: 1fr;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="kpi-container">
        <!-- Header -->
        <div class="page-header">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <div>
                    <h1>üìä Painel de KPIs</h1>
                    <p>Acompanhamento evolutivo de Demanda e Reabastecimento</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <a href="/" style="background: rgba(255,255,255,0.2); color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; font-size: 0.9em;">
                        üìà Demanda
                    </a>
                    <a href="/reabastecimento" style="background: rgba(255,255,255,0.2); color: white; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s; font-size: 0.9em;">
                        üì¶ Reabastecimento
                    </a>
                </div>
            </div>
        </div>

        <!-- Filtros -->
        <div class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="filter-loja">üè™ Loja</label>
                    <select id="filter-loja">
                        <option value="">Todas as Lojas</option>
                        <!-- Preenchido dinamicamente -->
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filter-produto">üì¶ Produto</label>
                    <select id="filter-produto">
                        <option value="">Todos os Produtos</option>
                        <!-- Preenchido dinamicamente -->
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filter-categoria">üè∑Ô∏è Categoria</label>
                    <select id="filter-categoria">
                        <option value="">Todas as Categorias</option>
                        <!-- Preenchido dinamicamente -->
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filter-fornecedor">üöö Fornecedor</label>
                    <select id="filter-fornecedor">
                        <option value="">Todos os Fornecedores</option>
                        <!-- Preenchido dinamicamente -->
                    </select>
                </div>
            </div>

            <div class="filter-actions">
                <button class="btn btn-secondary" onclick="limparFiltros()">Limpar Filtros</button>
                <button class="btn btn-primary" onclick="aplicarFiltros()">Aplicar Filtros</button>
            </div>
        </div>

        <!-- Tabs de Vis√£o Temporal -->
        <div class="view-tabs">
            <button class="view-tab active" onclick="mudarVisao('mensal')">üìÖ Vis√£o Mensal (12-24 meses)</button>
            <button class="view-tab" onclick="mudarVisao('semanal')">üìÜ Vis√£o Semanal (6-12 meses)</button>
        </div>

        <!-- SE√á√ÉO 1: KPIs de Demanda -->
        <div class="kpi-section">
            <div class="kpi-section-header">
                <div class="kpi-section-icon">üìà</div>
                <div class="kpi-section-title">
                    <h2>KPIs de Acur√°cia de Demanda</h2>
                    <p>M√©tricas de precis√£o das previs√µes: WMAPE e BIAS</p>
                </div>
            </div>

            <!-- M√©tricas Atuais - Demanda -->
            <div class="current-metrics">
                <div class="metric-card">
                    <div class="metric-card-header">
                        <span class="metric-label">WMAPE M√©dio</span>
                        <span class="metric-trend trend-down" id="wmape-trend">‚Üì 2.3%</span>
                    </div>
                    <div class="metric-value" id="wmape-atual">-</div>
                    <div class="metric-subtitle">√öltimos 30 dias</div>
                </div>

                <div class="metric-card">
                    <div class="metric-card-header">
                        <span class="metric-label">BIAS M√©dio</span>
                        <span class="metric-trend trend-stable" id="bias-trend">‚Üí 0.1%</span>
                    </div>
                    <div class="metric-value" id="bias-atual">-</div>
                    <div class="metric-subtitle">√öltimos 30 dias</div>
                </div>

                <div class="metric-card">
                    <div class="metric-card-header">
                        <span class="metric-label">Previs√µes Excelentes</span>
                        <span class="metric-trend trend-up" id="excelentes-trend">‚Üë 5.2%</span>
                    </div>
                    <div class="metric-value" id="previsoes-excelentes">-</div>
                    <div class="metric-subtitle">WMAPE < 10%</div>
                </div>

                <div class="metric-card">
                    <div class="metric-card-header">
                        <span class="metric-label">SKUs Analisados</span>
                        <span class="metric-trend trend-stable" id="skus-trend">‚Üí</span>
                    </div>
                    <div class="metric-value" id="total-skus">-</div>
                    <div class="metric-subtitle">Per√≠odo selecionado</div>
                </div>
            </div>

            <!-- Gr√°ficos - Demanda -->
            <div id="demanda-mensal" class="view-content active">
                <div class="charts-grid charts-grid-2col">
                    <div>
                        <h3 class="chart-title">Evolu√ß√£o WMAPE - Mensal</h3>
                        <div class="chart-container">
                            <canvas id="chart-wmape-mensal"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="chart-title">Evolu√ß√£o BIAS - Mensal</h3>
                        <div class="chart-container">
                            <canvas id="chart-bias-mensal"></canvas>
                        </div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div>
                        <h3 class="chart-title">Distribui√ß√£o de Classifica√ß√£o - WMAPE</h3>
                        <div class="chart-container">
                            <canvas id="chart-classificacao-wmape"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="demanda-semanal" class="view-content">
                <div class="charts-grid charts-grid-2col">
                    <div>
                        <h3 class="chart-title">Evolu√ß√£o WMAPE - Semanal</h3>
                        <div class="chart-container">
                            <canvas id="chart-wmape-semanal"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="chart-title">Evolu√ß√£o BIAS - Semanal</h3>
                        <div class="chart-container">
                            <canvas id="chart-bias-semanal"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SE√á√ÉO 2: KPIs de Gest√£o de Reabastecimento -->
        <div class="kpi-section">
            <div class="kpi-section-header">
                <div class="kpi-section-icon">üì¶</div>
                <div class="kpi-section-title">
                    <h2>KPIs de Gest√£o de Reabastecimento</h2>
                    <p>M√©tricas operacionais: Rupturas e Cobertura de Estoque</p>
                </div>
            </div>

            <!-- M√©tricas Atuais - Reabastecimento -->
            <div class="current-metrics">
                <div class="metric-card">
                    <div class="metric-card-header">
                        <span class="metric-label">Taxa de Ruptura</span>
                        <span class="metric-trend trend-down" id="ruptura-trend">‚Üì 1.2%</span>
                    </div>
                    <div class="metric-value" id="taxa-ruptura">-</div>
                    <div class="metric-subtitle">√öltimos 30 dias</div>
                </div>

                <div class="metric-card">
                    <div class="metric-card-header">
                        <span class="metric-label">Cobertura M√©dia</span>
                        <span class="metric-trend trend-up" id="cobertura-trend">‚Üë 0.5 dias</span>
                    </div>
                    <div class="metric-value" id="cobertura-media">-</div>
                    <div class="metric-subtitle">Dias de estoque</div>
                </div>

                <div class="metric-card">
                    <div class="metric-card-header">
                        <span class="metric-label">N√≠vel de Servi√ßo</span>
                        <span class="metric-trend trend-up" id="servico-trend">‚Üë 2.1%</span>
                    </div>
                    <div class="metric-value" id="nivel-servico">-</div>
                    <div class="metric-subtitle">% Atendimento</div>
                </div>

                <div class="metric-card">
                    <div class="metric-card-header">
                        <span class="metric-label">SKUs Cr√≠ticos</span>
                        <span class="metric-trend trend-down" id="criticos-trend">‚Üì 3 SKUs</span>
                    </div>
                    <div class="metric-value" id="skus-criticos">-</div>
                    <div class="metric-subtitle">Ruptura > 20%</div>
                </div>
            </div>

            <!-- Gr√°ficos - Reabastecimento -->
            <div id="reabastecimento-mensal" class="view-content active">
                <div class="charts-grid charts-grid-2col">
                    <div>
                        <h3 class="chart-title">Taxa de Ruptura - Mensal</h3>
                        <div class="chart-container">
                            <canvas id="chart-ruptura-mensal"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="chart-title">Cobertura de Estoque - Mensal</h3>
                        <div class="chart-container">
                            <canvas id="chart-cobertura-mensal"></canvas>
                        </div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div>
                        <h3 class="chart-title">N√≠vel de Servi√ßo - Mensal</h3>
                        <div class="chart-container">
                            <canvas id="chart-servico-mensal"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="reabastecimento-semanal" class="view-content">
                <div class="charts-grid charts-grid-2col">
                    <div>
                        <h3 class="chart-title">Taxa de Ruptura - Semanal</h3>
                        <div class="chart-container">
                            <canvas id="chart-ruptura-semanal"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="chart-title">Cobertura de Estoque - Semanal</h3>
                        <div class="chart-container">
                            <canvas id="chart-cobertura-semanal"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabela de Top/Bottom Performers -->
        <div class="kpi-section">
            <div class="kpi-section-header">
                <div class="kpi-section-icon">üèÜ</div>
                <div class="kpi-section-title">
                    <h2>Top & Bottom Performers</h2>
                    <p>Melhores e piores desempenhos por SKU</p>
                </div>
            </div>

            <table class="detail-table">
                <thead>
                    <tr>
                        <th>SKU</th>
                        <th>Descri√ß√£o</th>
                        <th>Loja</th>
                        <th>WMAPE</th>
                        <th>BIAS</th>
                        <th>Ruptura</th>
                        <th>Cobertura</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="performers-table">
                    <tr>
                        <td colspan="8" class="loading">
                            <div class="loading-spinner"></div>
                            Carregando dados...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/kpis.js') }}"></script>
</body>
</html>
